import os
os.environ["HTTP_PROXY"] = "http://127.0.0.1:7890"
os.environ["HTTPS_PROXY"] = "http://127.0.0.1:7890"
import streamlit as st
import google.generativeai as genai
from PIL import Image

# --- é¡µé¢é…ç½® ---##
st.set_page_config(page_title="PhotoVibe - AIæ–‡æ¡ˆåŠ©æ‰‹", page_icon="ğŸ“¸")

st.title("ğŸ“¸ PhotoVibe: è®©ä½ çš„ç…§ç‰‡ä¼šè¯´è¯")
st.write("ä¸Šä¼ ä¸€å¼ ç…§ç‰‡ï¼ŒAIå¸®ä½ ç”Ÿæˆé€‚åˆæœ‹å‹åœˆ/å°çº¢ä¹¦çš„æ–‡æ¡ˆã€‚")

# --- ä¾§è¾¹æ ï¼šè®¾ç½® ---
with st.sidebar:
    st.header("è®¾ç½®")
    api_key = st.text_input("è¯·è¾“å…¥ Google Gemini API Key", type="password")
    st.markdown("[ç‚¹å‡»è¿™é‡Œè·å–å…è´¹ API Key](https://aistudio.google.com/app/apikey)")

# --- ä¸»ç•Œé¢ ---
uploaded_file = st.file_uploader("é€‰æ‹©ä¸€å¼ ç…§ç‰‡...", type=["jpg", "jpeg", "png"])

if uploaded_file is not None:
    # æ˜¾ç¤ºå›¾ç‰‡
    image = Image.open(uploaded_file)
    st.image(image, caption='å·²ä¸Šä¼ ç…§ç‰‡', use_container_width=True)

    if api_key:
        if st.button("âœ¨ ç”Ÿæˆé«˜èµæ–‡æ¡ˆ"):
            with st.spinner('AI æ­£åœ¨è§‚å¯Ÿä½ çš„ç…§ç‰‡å¹¶æ„æ€æ–‡æ¡ˆ...'):
                try:
                    # ä½¿ç”¨ API Key åˆå§‹åŒ–å®¢æˆ·ç«¯
                    client = genai.Client(api_key=api_key)

                    prompt = """
                    ä½ æ˜¯ä¸€ä½æ‹¥æœ‰ç™¾ä¸‡ç²‰ä¸çš„èµ„æ·±æ‘„å½±åšä¸»ã€‚è¯·ä»”ç»†è§‚å¯Ÿè¿™å¼ ç…§ç‰‡ã€‚
                    è¯·åˆ›ä½œ 30 æ¡ä¸åŒé£æ ¼çš„ä¸­æ–‡ç¤¾äº¤åª’ä½“æ–‡æ¡ˆï¼š
                    1. ğŸ“– **æ–‡è‰ºå™äº‹é£**ï¼šé€‚åˆå‘æœ‹å‹åœˆï¼Œå¸¦ç‚¹æ·¡æ·¡çš„æƒ…ç»ªã€‚ä¸è¿‡ä¸è¦çŸ«æ‰é€ ä½œ
                    2. âš¡ **ç¡¬æ ¸å‚æ•°é£**ï¼šè¯„ä»·æ‹æ‘„æ‰‹æ³•ã€å…‰å½±ï¼Œé€‚åˆå±•ç¤ºä¸“ä¸šèƒ½åŠ›ã€‚
                    3. ğŸ˜ **å¹½é»˜/æ¾å¼›æ„Ÿ**ï¼šç®€çŸ­æœ‰è¶£ï¼Œé€‚åˆå°çº¢ä¹¦ã€‚
                    4.**æ‘„å½±æ–‡è‰º**ï¼šéœ€è¦æ–‡å­—èƒ½åæ˜ å‡ºè‡ªèº«æ‘„å½±å“å‘³ï¼Œæ·¡æ·¡çš„å¤§å¸ˆæ„Ÿ
                    5.**è¯—æ­Œæ–‡è‰º**ï¼šç»™ä¸¤ä¸‰å¥å°çŸ­è¯—ï¼Œç¬¦åˆæ–‡é’èŒƒå„¿
                    6.**æ‘„å½±å¤§å¸ˆ**ï¼šä»¥è‘—åæ‘„å½±å¤§å¸ˆçš„é£æ ¼å£å»ç‚¹è¯„ï¼Œä¾‹å¦‚alex webbï¼Œæ£®å±±å¤§é“ï¼Œæ‰æœ¬åšå¸ç­‰ç­‰
                    7.**æ–‡å­¦è‰ºæœ¯åäºº**ï¼šæ‘„å½±ä¸æ–‡å­¦è‰ºæœ¯äº’é€šï¼Œå¯ä»¥ä»¥ä¾‹å¦‚å²é“ç”Ÿæˆ–è€…è‘—åæ¬§ç¾ä½œå®¶ç­‰çš„å£å»
                    æ³¨æ„äº§å‡ºçš„æ–‡æ¡ˆæ–‡å­—ä¸ç”¨é‚£ä¹ˆå¤šï¼Œå› ä¸ºéœ€è¦åœ¨ç¤¾äº¤æµåª’ä½“ä¸Šé¢å‘å¸–ï¼Œä¸è¦é‚£ä¹ˆä¸€çœ¼è®©äººçœ‹å‡ºæ¥åƒaiå†™çš„ï¼Œæ¯ä¸ªæ–‡æ¡ˆåéœ€è¦æ¢è¡Œ
                    æœ€åï¼Œç»™å‡º 5 ä¸ªç›¸å…³çš„çƒ­é—¨ Hashtagã€‚
                    """
                    # ã€æ ¸å¿ƒä¿®æ”¹ã€‘æŒ‡å®šç²¾ç¡®çš„ç‰ˆæœ¬å· -002
                    response = client.models.generate_content(
                        model='gemini-2.5-flash',
                        contents=[prompt, image]
                    )


                    st.success("ç”ŸæˆæˆåŠŸï¼")
                    st.markdown(response.text)

                except Exception as e:
                    # å¦‚æœè¿˜æ˜¯æŠ¥é”™ï¼ŒæŠŠè¯¦ç»†é”™è¯¯æ‰“å°å‡ºæ¥
                    st.error(f"å‡ºé”™äº†: {e}")
    else:
        st.info("ğŸ‘ˆ è¯·å…ˆåœ¨å·¦ä¾§è¾“å…¥ API Keyã€‚")